<!DOCTYPE html><html><head><title>CUREX-The foreign currency exchange for all.</title><meta charset="UTF-8"><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script>var endpoint="http://localhost/api";var curcolor={};curcolor["EUR"]="rgba(255, 255, 100, 1)";curcolor["GBP"]="rgba(200, 200, 255, 1)";curcolor["USD"]="rgba(100, 255, 100, 1)";curcolor["AUD"]="rgba(255, 200, 200, 1)";var symbol={};symbol["EUR"]="€";symbol["GBP"]="£";symbol["USD"]="$";symbol["AUD"]="$";var curid=new Object;function tradebox(rate,invrate,volume,cur,invcur){this.rate=rate;this.invrate=invrate;this.volume=volume;this.cur=cur;this.invcur=invcur;this.html=function(){var ans='<div class="tb" id="tb'+this.rate+'" style="background-color: '+curcolor[this.cur]+';">';var linkargs="'"+this.invcur+"','"+this.cur+"','"+this.invrate+"'";ans+='<div class="mc" style="background-color: '+curcolor[this.invcur]+';" onclick="tw.new_trade('+linkargs+');">';ans+=this.invrate;ans+="</div>";linkargs="'"+this.cur+"','"+this.invcur+"','"+this.rate+"'";ans+='<div class="uc" onclick="tw.new_trade('+linkargs+');">';ans+=this.rate;ans+="</div>";ans+='<div class="vc">';ans+=symbol[this.cur]+this.volume.toLocaleString();ans+="</div>";ans+="</div>";return ans}}function front(v,cur,invcur){var self=this;this.spots=new Array();v.forEach(function(r){self.spots.push(new tradebox(r.rate,r.inv,r.vol,cur,invcur))});this.html=function(){var ans="";this.spots.forEach(function(i){ans+=i.html()});ans+='<div class="frontend">&gt;</div>';return ans}}function market(c,ic){this.self=this;this.cur=c;this.invcur=ic;this.fweak=null;this.fstrong=null;this.valid_rates_weak=new Array();this.valid_rates_strong=new Array();this.has_valid_rates=function(){return this.valid_rates_weak.length==0}this.get_name=function(){return this.cur+"/"+this.invcur}this.get_id=function(){return"mkt_"+this.cur+"_"+this.invcur}this.html=function(){var ans="";ans+='<div class="m" id="'+this.get_id()+'">';ans+='<div class="mt">'+this.cur+"/"+this.invcur+"</div>";ans+='<div class="mf">';ans+=this.fweak.html();ans+="</div>";ans+='<div class="mt" id="'+this.get_id()+'">'+this.invcur+"/"+this.cur+"</div>";ans+='<div class="mf">';ans+=this.fstrong.html();ans+="</div>";ans+="</div>";return ans}this.parselo=function(data){var lines=data.split('\n');var length=lines.length;var weaksig=curid[this.cur]+"/"+curid[this.invcur];var weakdata=new Array;var strongdata=new Array;for(var i=0;i<length;i++){var fields=lines[i].split(" ");if(fields.length!=4){continue}var rt=fields[0];var sig=fields[1];var v=fields[2];var invrt=fields[3];if(sig==weaksig){weakdata[weakdata.length]={rate:rt,inv:invrt,vol:v}}else{strongdata[strongdata.length]={rate:rt,inv:invrt,vol:v}}}weakdata.sort(function(va,vb){return parseFloat(va.rate)-parseFloat(vb.rate)});strongdata.sort(function(va,vb){return parseFloat(va.rate)-parseFloat(vb.rate)});this.fweak=new front(weakdata,this.cur,this.invcur);this.fstrong=new front(strongdata,this.invcur,this.cur);var id=this.get_id();$("#"+id).html(this.html())}this.load_valid_rates=function(){$.ajax({url:endpoint+"/?valid_rates_simple "+curid[this.cur]+" "+curid[this.invcur],dataType:"text"}).done(function(data){tw.parselo_valid_rates(this.cur,this.invcur,data)})}this.load=function(){var o=this;$.ajax({url:endpoint+"/?liquidity_simple "+curid[this.cur]+" "+curid[this.invcur],dataType:"text"}).done(function(data){o.parselo(data)})}}function markets(container){this.parent=container;this.m=new Array;this.html=function(){var ans="";this.m.forEach(function(r){ans+='<div class="market" id="'+r.get_id()+'">';ans+='<div class="msg">loading market '+r.get_name()+' ...</div>';ans+="</div>"});return ans}this.load_valid_rates=function(){var o=this;setTimeout(function(){o.m.forEach(function(r){r.load_valid_rates()})},100)}this.parselo=function(data){var lines=data.split('\n');var length=lines.length;this.m=new Array;for(var i=0;i<length;i++){var fields=lines[i].split(" ");if(fields.length!=2){continue}var curs=fields[0].split("/");if(curs.length!=2){continue}var curids=fields[1].split("/");if(curids.length!=2){continue}var mk=new market(curs[0],curs[1]);this.m.push(mk);curid[curs[0]]=curids[0];curid[curs[1]]=curids[1]}$("#"+this.parent).html(this.html());var o=this;setTimeout(function(){o.m.forEach(function(r){r.load()})},500)}this.load=function(){var o=this;$.ajax({url:endpoint+"/?list_markets",dataType:"text"}).done(function(data){o.parselo(data)})}}function new_trade(ticketid,therate,currency_src,currency_dest,rates){this.ticketid="ticket_"+ticketid;this.srccur=currency_src;this.dstcur=currency_dest;this.amount=100;this.rate=therate;this.valid_rates=rates;this.amount_txt_id=function(){return this.ticketid+"_amount"}this.rate_input_id=function(){return this.ticketid+"_rate"}this.get_rate_input=function(){var id=this.rate_input_id();var code='<select id="'+id+'">';if(this.valid_rates.length==0){code+='<option selected>'+this.rate+'..</option>'}else{var o=this;this.valid_rates.forEach(function(r){code+='<option';if(r==o.rate)code+=" selected";code+=">";code+=r+"</option>"})}code+="</select>";return code}this.valid_rates_available=function(cur,invcur,rates){if(cur!=this.srccur||invcur!=this.dstcur){return}this.valid_rates=rates;$("#"+this.rate_input_id()).replaceWith(this.get_rate_input())}this.html=function(){var ans="";ans+='<div class="newtrade" style="background-color: '+curcolor[this.srccur]+'">';ans+='<div style="margin: 4px; background-color: '+curcolor[this.dstcur]+'">Trade for '+this.dstcur+'</div>';ans+='<input id="'+this.amount_txt_id()+'" type="text" class="amount" value="'+this.amount+'"> '+this.srccur;ans+=' at rate ';ans+=this.get_rate_input();ans+=this.dstcur+'/'+this.srccur;ans+="<br/>";var conv=parseFloat(this.rate)*this.amount;ans+='<div style="width:100%; align: center; font-weight: bold;">'+conv.toFixed(2)+' '+this.dstcur+'</div>';ans+="";var submithandler="tw.submit_new_trade('"+this.ticketid+"',"+curid[this.srccur]+",'"+this.amount_txt_id()+"','"+this.rate_input_id()+"',"+curid[this.dstcur]+")";ans+='<input type="submit" value="Submit" onclick="'+submithandler+'"/>';var cancelhandler="tw.cancel_ticket('"+this.ticketid+"')";ans+='<input type="button" value="Cancel" onclick="'+cancelhandler+'"/>';ans+='</div>';return ans}}function new_trades(){this.items=new Array();this.ticketid=0;this.focus=function(){if(this.items.length==0)return;$('#'+this.items[this.items.length-1].amount_txt_id()).focus();$('#'+this.items[this.items.length-1].amount_txt_id()).select()}this.add=function(cur,invcur,rate,valid_rates){this.ticketid++;this.items.push(new new_trade(this.ticketid,rate,cur,invcur,valid_rates))}this.cancel_ticket=function(id){var o=this.items;this.items.some(function(r){if(r.ticketid==id){var index=o.indexOf(r);o.splice(index,1);return true}return false})}this.cancel_all_tickets=function(){this.items=new Array()}this.valid_rates_available=function(cur,invcur,valid_rates){this.items.forEach(function(r){r.valid_rates_available(cur,invcur,valid_rates)})}this.html=function(){var ans='<div class="trade"><div class="lbl">Submit new trades</div>';if(this.items.length==0){ans+='no waiting trades'}else{this.items.forEach(function(r){ans+='<div id="'+r.ticketid+'">';ans+=r.html();ans+='</div>'});if(this.items.length>1){ans+='<div style="padding-top: 5px;"><input type="button" value="Cancell all" onclick="tw.cancel_all_tickets()"></div>'}}ans+="</div>";return ans}}function unmatched_trade(orderid,amount,cur,therate,currency_dest){}function unmatched_trades(){this.items=new Array();this.update=function(orderid,amount,cur,rate,dstcur){}this.html=function(){var ans='<div class="trade"><div class="lbl">Waiting trades <input type="button" class="refresh" onclick="tw.refresh_tradeslip()"/></div>';ans+='no waiting trades';ans+='</div>';return ans}}function matched_trades(){this.html=function(){var ans='<div class="trade"><div class="lbl">Matched trades</div>';ans+='no matched trades';ans+='</div>';return ans}}function tradeslip(parent){this.parentid=parent;this.nid="nt";this.n=new new_trades();this.uid="ut";this.u=new unmatched_trades();this.mid="mt";this.m=new matched_trades();this.parse_orders=function(data){alert(data);return;var lines=data.split('\n');var length=lines.length;this.curs=new Array;for(var i=0;i<length;i++){var fields=lines[i].split(" ");if(fields.length!=6){continue}var type=fields[0];var orderid=fields[1];var amount=fields[2];var cur=fields[3];var rate=fields[4];var units=fields[5];var fieldsunits=units.split("/");if(fieldsunits.length!=2){alert("error! h78661324")continue}var dstcur=fieldsunits[0];if(type=="U"){this.u.update(orderid,amount,cur,rate,dstcur)}}}this.refresh=function(){var o=this;$.ajax({url:endpoint+"/?list_orders "+$("#user").val()+" "+$("#pwd").val(),dataType:"text"}).done(function(data){o.parse_orders(data)})}this.valid_rates_available=function(cur,invcur,valid_rates){this.n.valid_rates_available(cur,invcur,valid_rates)}this.new_trade=function(cur,invcur,rate,valid_rates){this.n.add(cur,invcur,rate,valid_rates);$('#'+this.nid).html(this.n.html());this.n.focus()}this.cancel_ticket=function(id){this.n.cancel_ticket(id);$('#'+this.nid).html(this.n.html())}this.cancel_all_tickets=function(){this.n.cancel_all_tickets();$('#'+this.nid).html(this.n.html())}this.html=function(){var ans='<div class="ts_title">Trade slip</div>';ans+='<div id="'+this.nid+'">';ans+=this.n.html();ans+='</div>';ans+='<div id="'+this.uid+'">';ans+=this.u.html();ans+='</div>';ans+='<div id="'+this.mid+'">';ans+=this.m.html();ans+='</div>';ans+='</div>';return ans}}function deposit_window(){this.curs=new Array;this.focus=function(){$('#depositamount').focus();$('#depositamount').select()}this.focus2=function(){$('#depositcurid').focus();$('#depositcurid').slideDown()}this.parselo=function(data){var lines=data.split('\n');var length=lines.length;this.curs=new Array;for(var i=0;i<length;i++){var fields=lines[i].split(" ");if(fields.length!=2){continue}var curid=fields[0];var curname=fields[1];this.curs.push({id:curid,cur:curname})}tw.show_deposit_window()}this.load=function(){if(this.curs.length!=0){return}var o=this;$.ajax({url:endpoint+"/?list_currencies",dataType:"text"}).done(function(data){o.parselo(data)})}this.get_cur_input=function(){var code='<select id="depositcurid">';if(this.curs.length==0){code+='<option selected>loading...</option>'}else{var o=this;code+='<option value="0" selected>select...</option>';this.curs.forEach(function(r){code+='<option value='+r.id+'>';code+=r.cur+"</option>"})}code+="</select>";return code}this.get_amount=function(){return $("#depositamount").val()}this.get_curid=function(){return $("#depositcurid").val()}this.html=function(){var ans="";ans+='Deposit amount <input type="text" id="depositamount" class="amount" value="0">';ans+=this.get_cur_input();ans+="<br/>";ans+='<input type="submit" value="Submit" onclick="tw.do_deposit()">';ans+='<input type="button" value="Cancel" onclick="tw.hide_deposit_window()">';return ans}}function trading_window(){this.mks_id='mks';this.ts_id='ts';this.ms=new markets(this.mks_id);this.ts=new tradeslip(this.ts);this.dw=new deposit_window();this.load=function(){this.ms.load()}this.load_valid_rates=function(){this.ms.load_valid_rates()}this.rates=new Array;this.valid_rates_available=function(cur,invcur,valid_rates){this.rates[{c:cur,i:invcur}]=valid_rates;this.ts.valid_rates_available(cur,invcur,this.rates[{c:cur,i:invcur}])}this.parselo_valid_rates=function(cur,invcur,data){var lines=data.split('\n');var length=lines.length;var valid_rates_weak=new Array;var valid_rates_strong=new Array;for(var i=0;i<length;i++){var fields=lines[i].split(" ");if(fields.length!=2){continue}var rt=fields[0];var invrt=fields[1];valid_rates_weak.push(rt);valid_rates_strong.push(invrt)}this.valid_rates_available(cur,invcur,valid_rates_weak);this.valid_rates_available(invcur,cur,valid_rates_strong)}this.new_trade=function(cur,invcur,rate){if(typeof this.rates[{c:cur,i:invcur}]=='undefined'){this.rates[{c:cur,i:invcur}]=new Array}this.ts.new_trade(cur,invcur,rate,this.rates[{c:cur,i:invcur}]);if(this.rates[{c:cur,i:invcur}].length==0){var o=this;var c=cur;var ic=invcur;$.ajax({url:endpoint+"/?valid_rates_simple "+curid[c]+" "+curid[ic],dataType:"text"}).done(function(data){o.parselo_valid_rates(c,ic,data)})}}this.show_deposit_window=function(){$("#dw").html(this.dw.html());$("#dw").css('display','block');this.focus_deposit_window();this.dw.load()}this.focus_deposit_window=function(){this.dw.focus()}this.focus_deposit_window2=function(){this.dw.focus2()}this.hide_deposit_window=function(){$("#dw").css('display','none')}this.handle_error_deposit=function(data){if(data.startsWith("Error: E")){var v1=data.substring(data.indexOf(' ')+1)var i=v1.indexOf(' ');var err=v1.substring(0,i);var msg=v1.substring(i+1)if(err=="E3;"){alert(msg);this.focus_deposit_window()}else if(err=="E4;"){alert("PLease select the currency you wish for depositing.");this.focus_deposit_window2()}else{alert(data)}return true}return false}this.handle_error_new_trade=function(data){if(data.startsWith("Error: E")){var v1=data.substring(data.indexOf(' ')+1)var i=v1.indexOf(' ');var err=v1.substring(0,i);var msg=v1.substring(i+1)if(err=="E16;"){alert(msg);this.show_deposit_window()}else{alert(data)}return true}return false}this.parse_answer_new_trade=function(data){if(this.handle_error_new_trade(data))return;alert(data)}this.submit_new_trade=function(ticketid,curid,amount_id,rate_id,dstcur){var amount=$("#"+amount_id).val();var rate=$("#"+rate_id).val();this.cancel_ticket(ticketid);var o=this;$.ajax({url:endpoint+"/?trade "+$("#user").val()+" "+$("#pwd").val()+" "+curid+" "+amount+" "+rate+" "+dstcur,dataType:"text"}).done(function(data){o.parse_answer_new_trade(data)})}this.cancel_ticket=function(id){this.ts.cancel_ticket(id)}this.cancel_all_tickets=function(){this.ts.cancel_all_tickets()}this.parse_answer_deposit=function(data){if(this.handle_error_deposit(data))return;alert(data);this.hide_deposit_window()}this.do_deposit=function(){var amount=this.dw.get_amount();var curid=this.dw.get_curid();var o=this;$.ajax({url:endpoint+"/?deposit "+$("#user").val()+" "+$("#pwd").val()+" "+curid+" "+amount,dataType:"text"}).done(function(data){o.parse_answer_deposit(data)})}this.refresh_tradeslip=function(){this.ts.refresh()}this.html=function(){var ans="";ans+='<div class="tw">';ans+='<div class="dw" id="dw">sssssssssssssssssssss</div>';ans+='<div class="'+this.mks_id+'" id="'+this.mks_id+'">';ans+='<div class="msg">loading markets...</div>';ans+='</div>';ans+='<div class="'+this.ts_id+'">';ans+=this.ts.html();ans+='</div>';ans+='</div>';return ans}}tw=new trading_window();$(document).ready(function(){$("#content").html(tw.html());setTimeout(tw.load(),100)});</script><style>.dw{position:fixed;margin:25px;padding:25px;left:100px;top:200px;text-align:center;background-color:khaki;border:3px solid black;display:none}.amount{width:50px;height:16px;font-size=10px;text-align:right}.tw{z width:50%white-space:nowrap}.newtrade.order{position:relative;width:100%;padding:2px;margin:2px;font-size:12px;border-radius:7px;-moz-border-radius:7px;-webkit-border-radius:7px;border:1px solid black}.trade{width:100%;margin:1px;padding:1px;background-color:#f0f0f0;font-size:10px}.lbl{margin:0px;padding:2px;background-color:black;color:white;font-size:20px}.ts_title{width:100%;background-color:black;color:white;font-size:25px}.ts{position:absolute;float:right;margin:0px;padding:3px;display:inline-block;background-color:khaki;width:30%;min-width:300px;height:100%}.mks{background-color:khaki;margin:1px;float:left;display:inline-block;width:70%}.frontend{width:300px;display:inline-block}.tb{margin:1px;margin-bottom:4px;margin-top:4px;padding:3px;text-align:center;vertical-align:middle;min-width:50px;max-width:80px;min-height:10px;border:1px solid black;font-size:10px;display:inline-block}.tb:hover{border:1px solid white}.mc{margin:0px;padding:0px;text-align:center;vertical-align:middle;float:left;width:100%;font-size:12px;font-weight:bold;cursor:pointer;font-family:Arial}.mc:hover{margin:0px;z background-color:khaki;color:red;font-weight:bold;font-family:Arial}.uc{margin:0px;padding:0px;text-align:center;vertical-align:middle;float:left;width:100%;font-size:12px;cursor:pointer;font-family:Arial}.uc:hover{margin:0px;z background-color:khaki;color:red;font-weight:bold;font-family:Arial}.vc{margin:0px;padding:0px;text-align:center;vertical-align:middle;float:left;width:100%;font-size:10px;font-family:Arial}.mt{margin:0px;padding:3px;padding-top:15px;text-align:center;z vertical-align:middle;z float:left;font-size:14px;font-weight:bold;z display:inline-block}.m{width:100%;padding:4px;margin:4px;background-color:khaki}.mf{width:100%;overflow-x:scroll;overflow-y:hidden;z white-space:nowrap;margin:0px;padding:0px;vertical-align:middle;background-color:#505050;z display:inline-block}.market{width:100%;overflow-x:hidden;overflow-y:hidden;white-space:nowrap;margin:0px;padding-top:0px;padding-left:0px;vertical-align:middle;background-color:white}.msg{margin:5px;font-size:20px;background-color:khaki;width:100%;height:100%}select,button,input[type="button"],input[type="submit"]{background-color:#ccc;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;color:#000;font-family:'Oswald';font-size:15px;text-decoration:none;cursor:pointer;border:1px solid black;margin:4px}.accountlbl{font-family:'Oswald';font-size:15px;margin:4px}.accountctrl{background-color:khaki;width:80px;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;font-family:'Oswald';font-size:15px;border:1px solid black;margin:4px;padding-left:4px}button:hover,input[type="button"]:hover,input[type="submit"]:hover{background:khaki;box-shadow:0px 0px 1px#777}</style></head><body><div id="loginbox"><span class="accountlbl">account id</span><input type="text"id="user"class="accountctrl"value="14"/><span class="accountlbl">password</span><input type="password"id="pwd"class="accountctrl"value="12345678"/></div><input type="button"onclick="tw.load_valid_rates()"/><div id="content"></div></body></html>