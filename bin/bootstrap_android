#!/bin/bash

v=$1
if [ "_$v" == "_" ]; then
    v="dev"
fi


if [ -d android_studio ]; then
	echo "error. directory exists ./android_studio"
	exit 1
fi

pwd=`pwd`

mkdir android_studio
cd android_studio

tar -xzf ../android/androidstudio_basic_activity.tgz

cd us-cash
ln -s ../../android/getdeps
#./getdeps
rm build.gradle
ln -s ../../android/build.gradle

cd gradle/wrapper
rm gradle-wrapper.properties
ln -s ../../../../android/gradle-wrapper.properties
cd ../..

cd app

ln -s ../../../android/keystore.jks

cat $pwd/sdk/java/build.gradle.snippet >> build.gradle
#echo "dependencies { implementation 'com.journeyapps:zxing-android-embedded:3.2.0@aar' }" >> build.gradle

sed -i "s/org.jetbrains.kotlin:kotlin-stdlib-jre7/org.jetbrains.kotlin:kotlin-stdlib-jdk7/" build.gradle

echo "dependencies { implementation 'com.google.zxing:core:3.2.0' }" >> build.gradle
echo "dependencies { implementation 'com.journeyapps:zxing-android-embedded:3.2.0@aar' }" >> build.gradle


echo "dependencies { implementation group: 'pl.droidsonroids.gif', name: 'android-gif-drawable', version: '1.2.12'}" >> build.gradle

sed -i "s/[VERSION]/$v/g" build.gradle


cd src/
rm main -rf
ln -s ../../../../android/main

cd ../..

./getdeps
cd ../..

echo "directory android_studio is ready"

